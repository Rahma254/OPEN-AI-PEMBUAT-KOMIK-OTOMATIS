<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nabila Ahmad - Grand Creative Studio V5 (Sultan Edition)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <!-- PERUBAHAN: Menambahkan library html2canvas untuk ekspor strip komik -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --bg-deep-space: #111317; --surface-primary: #1a1d23; --surface-secondary: #252932;
            --border-color: #333842; --text-primary: #e0e0e0; --text-secondary: #a0a4b8;
            --accent-primary: #8A2BE2; --accent-secondary: #4A90E2; --accent-tertiary: #34D399;
            --font-ui: 'Poppins', sans-serif; --font-literary: 'Cormorant Garamond', serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-ui); background-color: var(--bg-deep-space); color: var(--text-primary); line-height: 1.7; overflow-x: hidden; }

        /* ... CSS yang lain tetap sama ... */
        .marquee-container {
            width: 100%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-tertiary));
            color: white; padding: 0.5rem 0; overflow: hidden; white-space: nowrap; position: fixed; top: 0; left: 0; z-index: 1000;
        }
        .marquee-text { display: inline-block; padding-left: 100%; animation: marquee 30s linear infinite; font-weight: 600; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        .studio-container { max-width: 1600px; margin: 0 auto; padding: 2rem; padding-top: 5rem; }
        .studio-header { text-align: center; margin-bottom: 3rem; padding-bottom: 2rem; border-bottom: 1px solid var(--border-color); }
        .studio-header h1 { font-size: 3rem; font-weight: 700; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.5rem; }
        .studio-header p { color: var(--text-secondary); font-size: 1.2rem; }
        
        .card { background-color: var(--surface-primary); border-radius: 16px; padding: 2rem; border: 1px solid var(--border-color); transition: all 0.3s ease; }
        .card:hover { border-color: var(--accent-secondary); }

        .api-config-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .api-card { background: var(--surface-secondary); padding: 1.5rem; border-radius: 12px; }
        .api-card h3 { margin-bottom: 0.5rem; }
        .api-card input { width: 100%; padding: 0.8rem; margin-top: 0.5rem; background-color: var(--surface-primary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); }

        .studio-tabs { display: flex; flex-wrap: wrap; border-bottom: 1px solid var(--border-color); margin-bottom: 2rem; }
        .tab-button { padding: 1rem 1.5rem; cursor: pointer; border: none; background: none; color: var(--text-secondary); font-size: 1.1rem; font-weight: 600; position: relative; transition: color 0.3s ease; }
        .tab-button:hover { color: var(--text-primary); }
        .tab-button.active { color: var(--text-primary); }
        .tab-button.active::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 3px; background: linear-gradient(90deg, var(--accent-secondary), var(--accent-tertiary)); border-radius: 3px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .control-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .control-grid .card h3 { font-size: 1.3rem; margin-bottom: 1.5rem; }
        label { display: block; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem; }
        input[type="text"], input[type="file"], textarea, select { width: 100%; padding: 0.8rem 1rem; background-color: var(--surface-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-family: var(--font-ui); font-size: 1rem; margin-bottom: 1.5rem; }
        input[type="file"]::file-selector-button { background-color: var(--accent-secondary); color: white; border: none; padding: 0.8rem 1rem; border-radius: 8px; cursor: pointer; }
        textarea { resize: vertical; min-height: 120px; }
        .main-action-button { width: 100%; padding: 1.2rem; font-size: 1.2rem; font-weight: 700; color: white; background: linear-gradient(90deg, var(--accent-secondary), var(--accent-tertiary)); border: none; border-radius: 8px; cursor: pointer; margin-top: 1rem; transition: all 0.3s ease; display: flex; justify-content: center; align-items: center; gap: 1rem; }
        .main-action-button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .main-action-button:disabled { opacity: 0.5; cursor: not-allowed; }

        .output-container { margin-top: 3rem; }
        .output-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .output-header h2 { font-size: 2rem; }
        .copy-button, .download-button { padding: 0.6rem 1.2rem; background: var(--surface-secondary); color: var(--text-secondary); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.3s ease; text-decoration: none; }
        .copy-button:hover, .download-button:hover { background-color: var(--accent-tertiary); color: white; border-color: var(--accent-tertiary); }
        .output-box { background: var(--surface-primary); border-radius: 16px; padding: 2rem; border: 1px solid var(--border-color); min-height: 200px; font-family: var(--font-literary); font-size: 1.2rem; line-height: 1.8; white-space: pre-wrap; color: var(--text-primary); }
        .placeholder-text { color: var(--text-secondary); font-style: italic; font-family: var(--font-ui); font-size: 1.1rem; }
        
        .spinner { width: 24px; height: 24px; border: 3px solid rgba(255, 255, 255, 0.3); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* PERUBAHAN: CSS untuk Comic Strip */
        #comicStripOutput { display: flex; flex-direction: column; gap: 1.5rem; background-color: #000; padding: 2rem; border: 2px dashed var(--border-color); }
        .comic-panel { background: var(--surface-primary); border-radius: 8px; overflow: hidden; border: 1px solid var(--border-color); }
        .comic-panel img { width: 100%; display: block; }
        .panel-controls { padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
        .panel-controls textarea { background-color: #fff; color: #000; font-family: 'Comic Sans MS', cursive; font-weight: bold; text-align: center; border: 2px solid #000; border-radius: 12px; min-height: 60px; padding: 0.5rem; }
        .panel-controls .download-button { align-self: flex-end; }

        /* PERUBAHAN: CSS untuk sub-tab di Audio Studio */
        .sub-tabs { display: flex; gap: 1rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); }
        .sub-tab-button { padding: 0.5rem 1rem; cursor: pointer; background: none; border: none; color: var(--text-secondary); }
        .sub-tab-button.active { color: var(--text-primary); border-bottom: 2px solid var(--accent-tertiary); }
        .sub-tab-content { display: none; }
        .sub-tab-content.active { display: block; }
    </style>
</head>
<body>

    <div class="marquee-container">
        <p class="marquee-text">✨ Selamat Datang di Grand Creative Studio V5! Menampilkan Comic Strip Builder, Image-to-Comic, dan Text-to-Speech. ✨</p>
    </div>

    <div class="studio-container">
        <header class="studio-header">
            <h1>Grand Creative Studio V5</h1>
            <p>Novel, Comic, and Audio AI Powerhouse</p>
        </header>

        <section class="api-config-grid">
            <div class="api-card"><h3>Stability AI API</h3><input type="password" id="stabilityAIKey" placeholder="Untuk Comic Studio"></div>
            <div class="api-card"><h3>OpenAI API</h3><input type="password" id="openAIKey" placeholder="Untuk Novel & Audio Studio"></div>
            <div class="api-card"><h3>AssemblyAI API</h3><input type="password" id="assemblyAIKey" placeholder="Untuk Transkripsi Audio"></div>
            <div class="api-card"><h3>ElevenLabs API</h3><input type="password" id="elevenlabsAIKey" placeholder="Untuk Text-to-Speech"></div>
        </section>

        <nav class="studio-tabs">
            <button class="tab-button active" data-tab="novelStudio">Novel Studio</button>
            <button class="tab-button" data-tab="comicStudio">Comic Studio</button>
            <button class="tab-button" data-tab="audioStudio">Audio Studio</button>
        </nav>

        <!-- NOVEL STUDIO (Tidak ada perubahan) -->
        <div id="novelStudio" class="tab-content active">
             <!-- ... Konten Novel Studio tidak berubah ... -->
        </div>

        <!-- COMIC STUDIO (DIrombak total) -->
        <div id="comicStudio" class="tab-content">
             <div class="control-grid">
                <div class="card">
                    <h3>👤 Prompt Utama</h3>
                    <label for="comicChar">Deskripsi Karakter & Aksi</label>
                    <textarea id="comicCharAction" rows="4" placeholder="Contoh: Seorang detektif wanita tangguh dengan jas hujan, sedang memeriksa petunjuk di gang gelap, memegang senter, wajah tegang dan fokus."></textarea>
                    
                    <h3>🖼️ Ubah Foto Jadi Komik (Opsional)</h3>
                    <label for="comicImageInput">Unggah Gambar Referensi</label>
                    <input type="file" id="comicImageInput" accept="image/*">
                    <label for="imageStrength">Kekuatan Gambar (0.1 - 0.9)</label>
                    <input type="range" id="imageStrength" min="0.1" max="0.9" step="0.1" value="0.5" style="width:100%;">
                </div>
                <div class="card">
                    <h3>🎨 Gaya & Komposisi</h3>
                    <label for="comicStyle">Gaya Visual</label>
                    <select id="comicStyle">
                        <option value="comic-book">Komik Amerika</option>
                        <option value="anime">Anime</option>
                        <option value="photographic">Fotografis</option>
                        <option value="digital-art">Seni Digital</option>
                        <option value="line-art">Garis Seni</option>
                        <option value="cinematic">Sinematik</option>
                    </select>
                    <label for="comicAngle">Info Tambahan (Angle, Lighting)</label>
                    <input type="text" id="comicAngle" placeholder="Contoh: low-angle shot, neon city lights">
                </div>
            </div>
            <button id="addPanelBtn" class="main-action-button" style="margin-top: 2rem; max-width: 500px; margin-inline: auto;"><span class="btn-text">Tambah Panel ke Strip</span><div class="spinner" style="display: none;"></div></button>
            
            <div class="output-container">
                <div class="output-header">
                    <h2>Comic Strip Builder</h2>
                    <button id="exportStripBtn" class="download-button">Ekspor Seluruh Strip</button>
                </div>
                <div id="comicStripOutput" class="output-box">
                    <p class="placeholder-text">Panel komik Anda akan muncul di sini sebagai sebuah strip. Tambahkan beberapa panel untuk membuat cerita!</p>
                </div>
            </div>
        </div>

        <!-- AUDIO STUDIO (DIrombak dari Podcast Studio) -->
        <div id="audioStudio" class="tab-content">
            <div class="card">
                <nav class="sub-tabs">
                    <button class="sub-tab-button active" data-tab="transcription">Speech-to-Text</button>
                    <button class="sub-tab-button" data-tab="tts">Text-to-Speech</button>
                </nav>
                
                <!-- Sub-tab Transkripsi -->
                <div id="transcription" class="sub-tab-content active">
                    <h3>📤 Unggah & Transkripsi Audio</h3>
                    <label for="audioFile">Pilih File Audio (MP3, WAV, dll.)</label>
                    <input type="file" id="audioFile" accept="audio/*">
                    <button id="transcribeBtn" class="main-action-button" style="margin-top:1rem;"><span class="btn-text">Mulai Transkripsi</span><div class="spinner" style="display: none;"></div></button>
                    <div class="output-header" style="margin-top:2rem;"><h4>Hasil Transkripsi:</h4><button class="copy-button" onclick="copyToClipboard('podcastOutput')">Salin</button></div>
                    <div id="podcastOutput" class="output-box" style="font-family:var(--font-ui); font-size:1rem; min-height:100px;"><p class="placeholder-text">Teks dari audio Anda akan muncul di sini...</p></div>
                </div>

                <!-- Sub-tab Text-to-Speech -->
                <div id="tts" class="sub-tab-content">
                    <h3>📝 Ubah Teks Menjadi Suara</h3>
                    <label for="ttsText">Teks yang akan diubah menjadi suara</label>
                    <textarea id="ttsText" rows="6" placeholder="Ketik atau tempel naskah novel atau dialog komik Anda di sini..."></textarea>
                    <button id="generateSpeechBtn" class="main-action-button" style="margin-top:1rem;"><span class="btn-text">Buat Audio</span><div class="spinner" style="display: none;"></div></button>
                    <div class="output-header" style="margin-top:2rem;"><h4>Hasil Audio:</h4></div>
                    <div id="speechOutput" class="output-box" style="min-height:100px; display:flex; align-items:center; justify-content:center;"><p class="placeholder-text">Pemutar audio akan muncul di sini...</p></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // === ELEMEN DOM ===
            const stabilityAIKeyInput = document.getElementById('stabilityAIKey');
            const openAIKeyInput = document.getElementById('openAIKey');
            const assemblyAIKeyInput = document.getElementById('assemblyAIKey');
            const elevenlabsAIKeyInput = document.getElementById('elevenlabsAIKey');
            
            // Tabs Utama
            const tabs = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            // Novel
            // ... (Tidak berubah, bisa ditambahkan jika diperlukan)

            // Komik
            const charActionTextarea = document.getElementById('comicCharAction');
            const comicImageInput = document.getElementById('comicImageInput');
            const imageStrengthSlider = document.getElementById('imageStrength');
            const comicStyleSelect = document.getElementById('comicStyle');
            const comicAngleInput = document.getElementById('comicAngle');
            const addPanelBtn = document.getElementById('addPanelBtn');
            const comicStripOutputDiv = document.getElementById('comicStripOutput');
            const exportStripBtn = document.getElementById('exportStripBtn');

            // Audio Studio
            const audioTabs = document.querySelectorAll('.sub-tab-button');
            const audioTabContents = document.querySelectorAll('.sub-tab-content');
            const audioFileInput = document.getElementById('audioFile');
            const transcribeBtn = document.getElementById('transcribeBtn');
            const podcastOutputDiv = document.getElementById('podcastOutput');
            const ttsTextInput = document.getElementById('ttsText');
            const generateSpeechBtn = document.getElementById('generateSpeechBtn');
            const speechOutputDiv = document.getElementById('speechOutput');


            // === LOGIKA UTAMA ===

            // Sistem Tab Utama & Sub-Tab
            function setupTabs(tabButtons, tabContents) {
                tabButtons.forEach(tab => {
                    tab.addEventListener('click', () => {
                        tabButtons.forEach(item => item.classList.remove('active'));
                        tab.classList.add('active');
                        const target = document.getElementById(tab.dataset.tab);
                        tabContents.forEach(content => content.classList.remove('active'));
                        target.classList.add('active');
                    });
                });
            }
            setupTabs(tabs, tabContents);
            setupTabs(audioTabs, audioTabContents);

            
            // Handler Comic Studio
            addPanelBtn.addEventListener('click', async () => {
                const charAction = charActionTextarea.value.trim();
                const imageFile = comicImageInput.files[0];
                const imageStrength = imageStrengthSlider.value;
                const style = comicStyleSelect.value;
                const angle = comicAngleInput.value.trim();
                
                if (!charAction) { alert('Harap isi Deskripsi Karakter & Aksi!'); return; }

                const apiKey = stabilityAIKeyInput.value.trim();
                if (!apiKey) { alert('Harap isi kunci Stability AI API terlebih dahulu!'); return; }

                const finalPrompt = `A single comic book panel. Featuring: ${charAction}. ${angle ? `Extra info: ${angle}.` : ''} Extremely high quality, detailed, professional art.`;
                
                setLoading(addPanelBtn, true);

                const formData = new FormData();
                formData.append('prompt', finalPrompt);
                formData.append('style_preset', style);
                formData.append('output_format', 'png');
                
                let endpoint = 'https://api.stability.ai/v2beta/stable-image/generate/sd3';

                if (imageFile) {
                    endpoint = 'https://api.stability.ai/v2beta/stable-image/generate/image-to-image/sd3';
                    formData.append('image', imageFile);
                    formData.append('strength', imageStrength);
                }

                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Accept': 'image/*'
                        },
                        body: formData
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        const errorMessage = err.errors ? err.errors[0] : (err.name || 'Terjadi kesalahan');
                        throw new Error(`Error dari Stability AI: ${errorMessage}.`);
                    }

                    const imageBlob = await response.blob();
                    const imageUrl = URL.createObjectURL(imageBlob);

                    // Hapus placeholder jika ini panel pertama
                    if (comicStripOutputDiv.querySelector('.placeholder-text')) {
                        comicStripOutputDiv.innerHTML = '';
                    }

                    // Buat elemen panel baru dan tambahkan ke strip
                    const panelDiv = document.createElement('div');
                    panelDiv.className = 'comic-panel';
                    panelDiv.innerHTML = `
                        <img src="${imageUrl}" alt="Generated comic panel">
                        <div class="panel-controls">
                            <textarea placeholder="Ketik dialog di sini..."></textarea>
                            <a href="${imageUrl}" download="gcs_panel_${Date.now()}.png" class="download-button">Unduh Panel</a>
                        </div>
                    `;
                    comicStripOutputDiv.appendChild(panelDiv);

                } catch (error) {
                    alert(`Error: ${error.message}`);
                } finally {
                    setLoading(addPanelBtn, false);
                }
            });

            // Handler Tombol Ekspor Strip
            exportStripBtn.addEventListener('click', () => {
                if (comicStripOutputDiv.querySelector('.placeholder-text')) {
                    alert('Tidak ada panel untuk diekspor!');
                    return;
                }
                alert('Mempersiapkan ekspor... Ini mungkin memakan waktu beberapa saat.');
                html2canvas(comicStripOutputDiv, { 
                    backgroundColor: getComputedStyle(document.body).getPropertyValue('--bg-deep-space'),
                    useCORS: true 
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'comic_strip_gcs.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            });

            // Handler Audio Studio: Transkripsi (Sama seperti sebelumnya)
            transcribeBtn.addEventListener('click', async () => { /* ... Logika tidak berubah ... */ });

            // Handler Audio Studio: Text-to-Speech
            generateSpeechBtn.addEventListener('click', async () => {
                const text = ttsTextInput.value.trim();
                const apiKey = elevenlabsAIKeyInput.value.trim();
                if (!text) { alert('Harap isi teks yang akan diubah menjadi suara!'); return; }
                if (!apiKey) { alert('Harap isi kunci ElevenLabs API terlebih dahulu!'); return; }

                setLoading(generateSpeechBtn, true);
                speechOutputDiv.innerHTML = '<p class="placeholder-text">Membuat audio... Mohon tunggu.</p>';

                try {
                    const response = await fetch('https://api.elevenlabs.io/v1/text-to-speech/21m00Tcm4TlvDq8ikWAM', { // Menggunakan suara "Rachel" sebagai contoh
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'xi-api-key': apiKey
                        },
                        body: JSON.stringify({
                            text: text,
                            model_id: "eleven_multilingual_v2",
                            voice_settings: { stability: 0.5, similarity_boost: 0.75 }
                        })
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(`Error dari ElevenLabs: ${err.detail.message}`);
                    }

                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);

                    speechOutputDiv.innerHTML = `<audio controls src="${audioUrl}"></audio>`;

                } catch (error) {
                    alert(`Error: ${error.message}`);
                    speechOutputDiv.innerHTML = '<p class="placeholder-text">Gagal membuat audio. Cek kunci API Anda.</p>';
                } finally {
                    setLoading(generateSpeechBtn, false);
                }
            });
            
            // Fungsi pembantu loading
            function setLoading(button, isLoading) {
                const spinner = button.querySelector('.spinner');
                const btnText = button.querySelector('.btn-text');
                if (isLoading) {
                    button.disabled = true;
                    if (spinner) spinner.style.display = 'block';
                    if (btnText) btnText.style.opacity = '0.5';
                } else {
                    button.disabled = false;
                    if (spinner) spinner.style.display = 'none';
                    if (btnText) btnText.style.opacity = '1';
                }
            }
        });

        // Fungsi pembantu copy (tidak berubah)
        function copyToClipboard(elementId) { /* ... Logika tidak berubah ... */ }
    </script>
</body>
</html>
